webpackJsonp([1],{NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("/5sW"),n=a("Dd8w"),i=a.n(n),s=a("mvHQ"),r=a.n(s),l=a("Gu7T"),c=a.n(l),u=a("pVWW"),h={props:["apikey","mapboxStyle","actualCoords","showActual"],data:function(){return{mapboxgl:null,map:null,styleReady:!1,actualMarker:null,userCoords:null,userMarker:null,startTime:Date.now(),polygon:[[121.4849281311035,25.041282077030896],[121.48338317871094,25.034127684732027],[121.49436950683594,25.010328552422727],[121.50930404663085,25.02183982004383],[121.52097702026366,25.019662095434153],[121.53041839599611,25.008617325916603],[121.55376434326172,25.02479524164605],[121.5805435180664,25.040504445908475],[121.57178878784178,25.051546345696423],[121.56895637512207,25.072383277538737],[121.50604248046874,25.079069004534098],[121.50604248046874,25.05823320992254],[121.4849281311035,25.041282077030896]],defaultPosition:{bearing:0,center:[121.53076171875,25.04392598596459],zoom:10.2,pitch:0,speed:2}}},watch:{actualCoords:function(){this.userMarker&&!this.showActual&&(this.startTime=Date.now(),this.userMarker.remove())},showActual:function(t){this.mapboxgl&&this.map&&(!this.actualMarker&&t||this.actualMarker.remove(),this.fitToKyoto(),t?this.actualMarker=new this.mapboxgl.Marker({color:"#ffbb00"}).setLngLat(this.actualCoords).addTo(this.map):this.map&&this.mapboxgl&&this.map.getLayer("linebetween")&&(this.map.removeLayer("linebetween"),this.map.removeSource("linebetween"),this.map.removeLayer("circlearound"),this.map.removeSource("circlearound")))},userCoords:function(t){if(this.mapboxgl&&this.map&&(!this.userMarker&&t||this.userMarker.remove(),this.fitToKyoto(),t)){this.map.addLayer({id:"linebetween",type:"line",source:{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[[this.actualCoords.lng,this.actualCoords.lat],t]}}},layout:{},paint:{"line-color":"#77bbff","line-width":2}});var e=u([this.actualCoords.lng,this.actualCoords.lat],1e3,32);this.map.addLayer({id:"circlearound",type:"fill",source:{type:"geojson",data:{type:"Feature",geometry:e}},layout:{},paint:{"fill-color":"rgba(255,187,0,.3)"}}),this.userMarker=new this.mapboxgl.Marker({color:"#77bbff"}).setLngLat(t).addTo(this.map);var a=function(t,e,a,o){var n=p(a-t),i=p(o-e),s=Math.sin(n/2)*Math.sin(n/2)+Math.cos(p(t))*Math.cos(p(a))*Math.sin(i/2)*Math.sin(i/2),r=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return 6371*r}.apply(void 0,[this.actualCoords.lng,this.actualCoords.lat].concat(c()(t)));this.$emit("distanceOff",a);var o={actualCoords:[this.actualCoords.lng,this.actualCoords.lat],userCoords:t,date:new Date,distanceOffInKm:a,timeTakenInMs:Date.now()-this.startTime};fetch("http://0.0.0.0:3008/dataupload",{method:"post",headers:{"Content-Type":"application/json"},body:r()(o)}).then(function(t){return t.json()}).then(function(t){t&&"ok"===t.status?console.info("saved!"):console.error("Failed on server!",t.status)})}}},mounted:function(){var t=this;document&&(this.mapboxgl=a("1e2d"),this.mapboxgl.accessToken=this.apikey,this.map=new this.mapboxgl.Map(i()({container:"map",style:this.mapboxStyle},this.defaultPosition)),this.map.on("styledata",function(){setTimeout(function(){return t.styleReady=!0},300),t.map.setLayoutProperty("country-label","text-field",["get","name_zh-Hans"]),t.map.setLayoutProperty("state-label","text-field",["get","name_zh-Hans"]),t.map.setLayoutProperty("place-city-label","text-field",["get","name_zh-Hans"]),t.map.setLayoutProperty("place-town-village-hamlet-label","text-field",["get","name_zh-Hans"]),t.map.setLayoutProperty("place-neighborhood-suburb-label","text-field",["get","name_zh-Hans"]),t.map.setLayoutProperty("road-label","text-field",["get","name_zh-Hans"])}),this.map.on("load",function(){t.fitToKyoto(),t.map.addLayer({id:"kyotooutlinelayer",type:"line",source:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[t.polygon]}}},layout:{},paint:{"line-color":"#0099ff","line-width":3}})}),this.map.on("click",function(e){e.lngLat&&(t.showActual||(t.$emit("showActual"),t.userCoords=[e.lngLat.lng,e.lngLat.lat]))}))},methods:{fitToKyoto:function(){this.map.fitBounds([[Math.max.apply(Math,c()(this.polygon.map(function(t){return t[0]}))),Math.max.apply(Math,c()(this.polygon.map(function(t){return t[1]})))],[Math.min.apply(Math,c()(this.polygon.map(function(t){return t[0]}))),Math.min.apply(Math,c()(this.polygon.map(function(t){return t[1]})))]],{padding:{top:20,left:20,bottom:20,right:20}})}}};function p(t){return t*(Math.PI/180)}var d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{height:"100%"}},[e("div",{class:{ready:this.styleReady},attrs:{id:"map"}}),this._v(" "),this.styleReady?[this._t("default",null,{mapboxgl:this.mapboxgl,map:this.map})]:this._e()],2)},staticRenderFns:[]};var m={props:["actualCoords","showActual"],components:{MapboxMapLoader:a("VU/8")(h,d,!1,function(t){a("nUPs")},null,null).exports},data:function(){return{ak:"pk.eyJ1IjoibWlkYmx1ZSIsImEiOiJmNWJlNzhkOThjNmVjMmRkMWNhZmJkZmY0OWI5YjZjNyJ9.T-Mn0TJBSXOsUZ_5fpL2qg",markers:[],updatePrefix:0}},computed:{},watch:{},methods:{}},f={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("MapboxMapLoader",{attrs:{apikey:t.ak,mapboxStyle:"mapbox://styles/midblue/cjv2c454j6eoy1fnx66ks9tpw",actualCoords:t.actualCoords,showActual:t.showActual},on:{showActual:function(e){return t.$emit("showActual")},distanceOff:function(e){return t.$emit("distanceOff",e)}},scopedSlots:t._u([{key:"default",fn:function(t){t.mapboxgl,t.map,t.clusterer}}])})},staticRenderFns:[]};var y=a("VU/8")(m,f,!1,function(t){a("pCKM")},null,null).exports,g=a("pmO9"),v={components:{Map:y},data:function(){return{lat:null,lng:null,showActual:!1,distanceOff:null,panoObject:null,gk:"AIzaSyDHjENlsAzLbBGvCJDziu7PgV5KyGcD8mY",taipeiPolygon:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[121.4849281311035,25.041282077030896],[121.48338317871094,25.034127684732027],[121.49436950683594,25.010328552422727],[121.50930404663085,25.02183982004383],[121.52097702026366,25.019662095434153],[121.53041839599611,25.008617325916603],[121.55376434326172,25.02479524164605],[121.5805435180664,25.040504445908475],[121.57178878784178,25.051546345696423],[121.56895637512207,25.072383277538737],[121.50604248046874,25.079069004534098],[121.50604248046874,25.05823320992254],[121.4849281311035,25.041282077030896]]]}}}},watch:{distanceOff:function(t){t>0&&t<1&&setTimeout(function(){console.log("Winner!!",new Date)},300)}},created:function(){var t=document.createElement("script");t.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+this.gk+"&callback=initializeGoogleMapsAPI"),window.initializeGoogleMapsAPI=this.nextLocation,document.head.appendChild(t)},methods:{getRandomPoint:function(){return g(1,this.taipeiPolygon)[0]},nextLocation:function(){var t=this;this.showActual=!1;var e=this.getRandomPoint().geometry.coordinates,a=Math.floor(360*Math.random());this.lat=e[1],this.lng=e[0],this.panoObject?(this.panoObject.setPosition({lat:this.lat,lng:this.lng}),this.panoObject.setPov({heading:a,pitch:0,zoom:0})):this.panoObject=new google.maps.StreetViewPanorama(this.$refs.streetview,{position:{lat:this.lat,lng:this.lng},pov:{heading:a,pitch:0},showRoadLabels:!1,zoom:0}),setTimeout(function(){t.panoObject.pano||(console.log("pano failed!"),t.nextLocation())},700)}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"streetviewcontainer"},[a("div",{ref:"streetview",attrs:{id:"streetview"}})]),t._v(" "),a("div",{staticClass:"right"},[a("div",{staticClass:"righttop"},[t.showActual?a("div",[t.distanceOff&&t.distanceOff>1?[t._v("Close!")]:t._e(),t._v(" "),t.distanceOff&&t.distanceOff<=1&&t.distanceOff>0?[t._v("You got it!")]:t._e(),t._v(" "),t.distanceOff&&t.distanceOff>0?[t._v("\n          The spot you picked is\n          "),a("span",{staticClass:"highlight"},[t._v(t._s(t.distanceOff.toFixed(2))+"km away.")]),t._v("ã€‚\n        ")]:t._e()],2):a("div",[t._v("Where do you think this is? Pick a location.")]),t._v(" "),t.showActual?a("button",{staticClass:"nextbutton",on:{click:t.nextLocation}},[t._v("\n        Next\n      ")]):t._e()]),t._v(" "),a("Map",{attrs:{actualCoords:{lat:t.lat,lng:t.lng},showActual:t.showActual},on:{showActual:function(e){t.showActual=!0},distanceOff:function(e){return t.distanceOff=e}}})],1)])},staticRenderFns:[]};var w=a("VU/8")(v,b,!1,function(t){a("q1tG")},null,null).exports;o.a.config.productionTip=!1,new o.a({el:"#app",render:function(t){return t(w)}})},nUPs:function(t,e){},pCKM:function(t,e){},q1tG:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.259628fb4df5e9367e45.js.map