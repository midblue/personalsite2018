{"version":3,"sources":["webpack:///src/components/MapboxMapLoader.vue","webpack:///./src/components/MapboxMapLoader.vue?552c","webpack:///./src/components/MapboxMapLoader.vue","webpack:///src/components/Map.vue","webpack:///./src/components/Map.vue?3574","webpack:///./src/components/Map.vue","webpack:///src/App.vue","webpack:///./src/App.vue?3fff","webpack:///./src/App.vue","webpack:///./src/main.js"],"names":["circleToPolygon","__webpack_require__","MapboxMapLoader","props","data","mapboxgl","map","styleReady","actualMarker","userCoords","userMarker","startTime","Date","now","polygon","defaultPosition","bearing","center","zoom","pitch","speed","watch","actualCoords","this","showActual","remove","shouldShow","fitToKyoto","Marker","color","setLngLat","addTo","getLayer","removeLayer","removeSource","newCoords","addLayer","id","type","source","geometry","coordinates","lng","lat","layout","paint","line-color","line-width","fill-color","distance","lat1","lon1","lat2","lon2","dLat","deg2rad","dLon","a","Math","sin","cos","c","atan2","sqrt","apply","undefined","concat","toConsumableArray_default","$emit","payloadToDatabase","date","distanceOffInKm","timeTakenInMs","fetch","method","headers","Content-Type","body","stringify_default","then","res","json","status","console","info","error","mounted","_this","document","accessToken","apikey","Map","extends_default","container","style","mapboxStyle","on","setTimeout","setLayoutProperty","e","lngLat","methods","fitBounds","max","p","min","padding","top","left","bottom","right","deg","PI","components_MapboxMapLoader","render","_h","$createElement","_c","_self","staticStyle","height","class","ready","attrs","_v","_t","_e","staticRenderFns","components","normalizeComponent","ssrContext","ak","markers","updatePrefix","computed","components_Map","_vm","$event","distanceOff","scopedSlots","_u","key","fn","ref","clusterer","src_components_Map","Map_normalizeComponent","randomPointsOnPolygon","App","panoObject","gk","taipeiPolygon","properties","newDistance","log","created","mapsAPIScript","createElement","setAttribute","window","initializeGoogleMapsAPI","nextLocation","head","appendChild","getRandomPoint","point","heading","floor","random","setPosition","setPov","google","maps","StreetViewPanorama","$refs","streetview","position","pov","showRoadLabels","pano","selectortype_template_index_0_src_App","staticClass","_s","toFixed","click","src_App","App_normalizeComponent","Vue","config","productionTip","el","h"],"mappings":"oLAUAA,EAAAC,EAAA,QAEAC,GACAC,OAAA,oDAEAC,KAHA,WAIA,OACAC,SAAA,KACAC,IAAA,KACAC,YAAA,EACAC,aAAA,KACAC,WAAA,KACAC,WAAA,KACAC,UAAAC,KAAAC,MACAC,UACA,uCACA,wCACA,wCACA,uCACA,wCACA,wCACA,uCACA,uCACA,wCACA,wCACA,wCACA,uCACA,uCAEAC,iBACAC,QAAA,EACAC,QAAA,mCACAC,KAAA,KACAC,MAAA,EACAC,MAAA,KAKAC,OACAC,aADA,WAEAC,KAAAb,aAAAa,KAAAC,aACAD,KAAAZ,UAAAC,KAAAC,MACAU,KAAAb,WAAAe,WAGAD,WAPA,SAOAE,GACAH,KAAAlB,UAAAkB,KAAAjB,OACAiB,KAAAf,cAAAkB,GAAAH,KAAAf,aAAAiB,SAEAF,KAAAI,aAEAD,EACAH,KAAAf,aAAA,IAAAe,KAAAlB,SAAAuB,QAAAC,MAAA,YACAC,UAAAP,KAAAD,cACAS,MAAAR,KAAAjB,KAEAiB,KAAAjB,KAAAiB,KAAAlB,UAAAkB,KAAAjB,IAAA0B,SAAA,iBACAT,KAAAjB,IAAA2B,YAAA,eACAV,KAAAjB,IAAA4B,aAAA,eACAX,KAAAjB,IAAA2B,YAAA,gBACAV,KAAAjB,IAAA4B,aAAA,mBAIAzB,WA1BA,SA0BA0B,GACA,GAAAZ,KAAAlB,UAAAkB,KAAAjB,OACAiB,KAAAb,YAAAyB,GAAAZ,KAAAb,WAAAe,SAEAF,KAAAI,aAEAQ,GAAA,CACAZ,KAAAjB,IAAA8B,UACAC,GAAA,cACAC,KAAA,OACAC,QACAD,KAAA,UACAlC,MACAkC,KAAA,UACAE,UACAF,KAAA,aACAG,cACAlB,KAAAD,aAAAoB,IAAAnB,KAAAD,aAAAqB,KACAR,MAKAS,UACAC,OACAC,aAAA,UACAC,aAAA,KAIA,IAAAjC,EAAAd,GACAuB,KAAAD,aAAAoB,IAAAnB,KAAAD,aAAAqB,KACA,IACA,IAGApB,KAAAjB,IAAA8B,UACAC,GAAA,eACAC,KAAA,OACAC,QACAD,KAAA,UACAlC,MACAkC,KAAA,UACAE,SAAA1B,IAGA8B,UACAC,OACAG,aAAA,wBAIAzB,KAAAb,WAAA,IAAAa,KAAAlB,SAAAuB,QAAAC,MAAA,YACAC,UAAAK,GACAJ,MAAAR,KAAAjB,KAEA,IAAA2C,EAgIA,SAAAC,EAAAC,EAAAC,EAAAC,GACA,IACAC,EAAAC,EAAAH,EAAAF,GACAM,EAAAD,EAAAF,EAAAF,GACAM,EACAC,KAAAC,IAAAL,EAAA,GAAAI,KAAAC,IAAAL,EAAA,GACAI,KAAAE,IAAAL,EAAAL,IACAQ,KAAAE,IAAAL,EAAAH,IACAM,KAAAC,IAAAH,EAAA,GACAE,KAAAC,IAAAH,EAAA,GACAK,EAAA,EAAAH,KAAAI,MAAAJ,KAAAK,KAAAN,GAAAC,KAAAK,KAAA,EAAAN,IAEA,OAXA,KAUAI,GA3IAG,WAAAC,GACA1C,KAAAD,aAAAoB,IACAnB,KAAAD,aAAAqB,KAFAuB,OAAAC,IAGAhC,KAEAZ,KAAA6C,MAAA,cAAAnB,GAEA,IAAAoB,GACA/C,cAAAC,KAAAD,aAAAoB,IAAAnB,KAAAD,aAAAqB,KACAlC,WAAA0B,EACAmC,KAAA,IAAA1D,KACA2D,gBAAAtB,EACAuB,cAAA5D,KAAAC,MAAAU,KAAAZ,WAEA8D,MAAA,kCACAC,OAAA,OACAC,SAAAC,eAAA,oBACAC,KAAAC,IAAAT,KAEAU,KAAA,SAAAC,GACA,OAAAA,EAAAC,SAEAF,KAAA,SAAA3E,GACAA,GAAA,OAAAA,EAAA8E,OAEAC,QAAAC,KAAA,UADAD,QAAAE,MAAA,oBAAAjF,EAAA8E,aAOAI,QAtJA,WAsJA,IAAAC,EAAAhE,KACAiE,WACAjE,KAAAlB,SAAAJ,EAAA,QACAsB,KAAAlB,SAAAoF,YAAAlE,KAAAmE,OAEAnE,KAAAjB,IAAA,IAAAiB,KAAAlB,SAAAsF,IAAAC,KACAC,UAAA,MACAC,MAAAvE,KAAAwE,aACAxE,KAAAR,kBAGAQ,KAAAjB,IAAA0F,GAAA,uBACAC,WAAA,kBAAAV,EAAAhF,YAAA,QAEAgF,EAAAjF,IAAA4F,kBAAA,8BACA,MACA,iBAEAX,EAAAjF,IAAA4F,kBAAA,4BACA,MACA,iBAEAX,EAAAjF,IAAA4F,kBAAA,iCACA,MACA,iBAGAX,EAAAjF,IAAA4F,kBACA,kCACA,cACA,uBAGAX,EAAAjF,IAAA4F,kBACA,kCACA,cACA,uBAGAX,EAAAjF,IAAA4F,kBAAA,2BACA,MACA,mBAIA3E,KAAAjB,IAAA0F,GAAA,kBACAT,EAAA5D,aACA4D,EAAAjF,IAAA8B,UACAC,GAAA,oBACAC,KAAA,OACAC,QACAD,KAAA,UACAlC,MACAkC,KAAA,UACAE,UACAF,KAAA,UACAG,aAAA8C,EAAAzE,YAIA8B,UACAC,OACAC,aAAA,UACAC,aAAA,OAKAxB,KAAAjB,IAAA0F,GAAA,iBAAAG,GACAA,EAAAC,SACAb,EAAA/D,aAGA+D,EAAAnB,MAAA,cACAmB,EAAA9E,YAAA0F,EAAAC,OAAA1D,IAAAyD,EAAAC,OAAAzD,WAIA0D,SACA1E,WADA,WAEAJ,KAAAjB,IAAAgG,YAGA5C,KAAA6C,IAAAvC,MAAAN,KAAAS,IAAA5C,KAAAT,QAAAR,IAAA,SAAAkG,GAAA,OAAAA,EAAA,OACA9C,KAAA6C,IAAAvC,MAAAN,KAAAS,IAAA5C,KAAAT,QAAAR,IAAA,SAAAkG,GAAA,OAAAA,EAAA,SAGA9C,KAAA+C,IAAAzC,MAAAN,KAAAS,IAAA5C,KAAAT,QAAAR,IAAA,SAAAkG,GAAA,OAAAA,EAAA,OACA9C,KAAA+C,IAAAzC,MAAAN,KAAAS,IAAA5C,KAAAT,QAAAR,IAAA,SAAAkG,GAAA,OAAAA,EAAA,UAGAE,SAAAC,IAAA,GAAAC,KAAA,GAAAC,OAAA,GAAAC,MAAA,SAoBA,SAAAvD,EAAAwD,GACA,OAAAA,GAAArD,KAAAsD,GAAA,KClRA,IAGeC,GADEC,OAFP,WAAgB,IAAaC,EAAb5F,KAAa6F,eAA0BC,EAAvC9F,KAAuC+F,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,aAAaC,OAAA,UAAiBH,EAAA,OAAYI,OAAOC,MAAjInG,KAAiIhB,YAAwBoH,OAAQtF,GAAA,SAAjKd,KAA6KqG,GAAA,KAA7KrG,KAA6K,YAA7KA,KAA6KsG,GAAA,gBAAuDxH,SAApOkB,KAAoOlB,SAAAC,IAApOiB,KAAoOjB,OAApOiB,KAA0QuG,MAAA,IAEpQC,oBCChC,ICcApC,GACAxF,OAAA,6BACA6H,YACA9H,gBDjByBD,EAAQ,OAcjCgI,CACE/H,EACA+G,GATF,EAVA,SAAAiB,GACEjI,EAAQ,SAaV,KAEA,MAUgC,SCJhCG,KALA,WAMA,OACA+H,GAAA,qGACAC,WACAC,aAAA,IAIAC,YAEAjH,SAEAgF,YC3BekC,GADErB,OANP,WAAgB,IAAAsB,EAAAjH,KAAa4F,EAAAqB,EAAApB,eAAkD,OAAxBoB,EAAAlB,MAAAD,IAAAF,GAAwB,mBAA6BQ,OAAOjC,OAAA8C,EAAAL,GAAApC,YAAA,oDAAAzE,aAAAkH,EAAAlH,aAAAE,WAAAgH,EAAAhH,YAA8IwE,IAAKxE,WAAA,SAAAiH,GAA8B,OAAAD,EAAApE,MAAA,eAA+BsE,YAAA,SAAAzF,GAAoC,OAAAuF,EAAApE,MAAA,cAAAnB,KAA8C0F,YAAAH,EAAAI,KAAsBC,IAAA,UAAAC,GAAA,SAAAC,GACrbA,EAAA1I,SACA0I,EAAAzI,IACAyI,EAAAC,iBAGgCjB,oBCHhC,IAuBekB,EAvBUhJ,EAAQ,OAcjBiJ,CACdvD,EACA4C,GAT6B,EAV/B,SAAoBL,GAClBjI,EAAQ,SAaS,KAEU,MAUG,QCUhCkJ,EAAAlJ,EAAA,QAEAmJ,GACApB,YAAArC,IAAAsD,GACA7I,KAFA,WAGA,OACAuC,IAAA,KACAD,IAAA,KACAlB,YAAA,EACAkH,YAAA,KACAW,WAAA,KACAC,GAAA,0CACAC,eACAjH,KAAA,UACAkH,cACAhH,UACAF,KAAA,UACAG,eAEA,uCACA,wCACA,wCACA,uCACA,wCACA,wCACA,uCACA,uCACA,wCACA,wCACA,wCACA,uCACA,4CAOApB,OACAqH,YADA,SACAe,GACAA,EAAA,GAAAA,EAAA,GACAxD,WAAA,WACAd,QAAAuE,IAAA,eAAA9I,OACA,OAIA+I,QA7CA,WA8CA,IAAAC,EAAApE,SAAAqE,cAAA,UACAD,EAAAE,aACA,MADA,+CAEAvI,KAAA+H,GAFA,qCAIAS,OAAAC,wBAAAzI,KAAA0I,aACAzE,SAAA0E,KAAAC,YAAAP,IAEAvD,SACA+D,eADA,WAEA,OAAAjB,EAAA,EAAA5H,KAAAgI,eAAA,IAEAU,aAJA,WAIA,IAAA1E,EAAAhE,KACAA,KAAAC,YAAA,EACA,IAAA6I,EAAA9I,KAAA6I,iBAAA5H,SAAAC,YACA6H,EAAA5G,KAAA6G,MAAA,IAAA7G,KAAA8G,UAEAjJ,KAAAoB,IAAA0H,EAAA,GACA9I,KAAAmB,IAAA2H,EAAA,GACA9I,KAAA8H,YAYA9H,KAAA8H,WAAAoB,aAAA9H,IAAApB,KAAAoB,IAAAD,IAAAnB,KAAAmB,MACAnB,KAAA8H,WAAAqB,QAAAJ,UAAAnJ,MAAA,EAAAD,KAAA,KAZAK,KAAA8H,WAAA,IAAAsB,OAAAC,KAAAC,mBACAtJ,KAAAuJ,MAAAC,YAEAC,UAAArI,IAAApB,KAAAoB,IAAAD,IAAAnB,KAAAmB,KACAuI,KAAAX,UAAAnJ,MAAA,GAEA+J,gBAAA,EACAhK,KAAA,IAQA+E,WAAA,WACAV,EAAA8D,WAAA8B,OACAhG,QAAAuE,IAAA,gBACAnE,EAAA0E,iBAEA,QCzHemB,GADElE,OAFP,WAAgB,IAAAsB,EAAAjH,KAAa4F,EAAAqB,EAAApB,eAA0BC,EAAAmB,EAAAlB,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAAA,EAAA,OAA2BgE,YAAA,wBAAkChE,EAAA,OAAY0B,IAAA,aAAApB,OAAwBtF,GAAA,kBAAmBmG,EAAAZ,GAAA,KAAAP,EAAA,OAA0BgE,YAAA,UAAoBhE,EAAA,OAAYgE,YAAA,aAAuB7C,EAAA,WAAAnB,EAAA,OAAAmB,EAAAE,aAAAF,EAAAE,YAAA,GAAAF,EAAAZ,GAAA,WAAAY,EAAAV,KAAAU,EAAAZ,GAAA,KAAAY,EAAAE,aAAAF,EAAAE,aAAA,GAAAF,EAAAE,YAAA,GAAAF,EAAAZ,GAAA,gBAAAY,EAAAV,KAAAU,EAAAZ,GAAA,KAAAY,EAAAE,aAAAF,EAAAE,YAAA,GAAAF,EAAAZ,GAAA,kDAAAP,EAAA,QAA0UgE,YAAA,cAAwB7C,EAAAZ,GAAAY,EAAA8C,GAAA9C,EAAAE,YAAA6C,QAAA,kBAAA/C,EAAAZ,GAAA,gBAAAY,EAAAV,MAAA,GAAAT,EAAA,OAAAmB,EAAAZ,GAAA,kDAAAY,EAAAZ,GAAA,KAAAY,EAAA,WAAAnB,EAAA,UAA2MgE,YAAA,aAAArF,IAA6BwF,MAAAhD,EAAAyB,gBAA0BzB,EAAAZ,GAAA,4BAAAY,EAAAV,OAAAU,EAAAZ,GAAA,KAAAP,EAAA,OAAsEM,OAAOrG,cAAgBqB,IAAA6F,EAAA7F,IAAAD,IAAA8F,EAAA9F,KAA6BlB,WAAAgH,EAAAhH,YAA6BwE,IAAKxE,WAAA,SAAAiH,GAA8BD,EAAAhH,YAAA,GAAsBkH,YAAA,SAAAzF,GAAoC,OAAAuF,EAAAE,YAAAzF,OAAyC,MAE/nC8E,oBCChC,IAuBe0D,EAvBUxL,EAAQ,OAcjByL,CACdtC,EACAgC,GAT6B,EAV/B,SAAoBlD,GAClBjI,EAAQ,SAaS,KAEU,MAUG,QCvBhC0L,IAAIC,OAAOC,eAAgB,EAE3B,IAAIF,KACFG,GAAI,OACJ5E,OAAQ,SAAA6E,GAAA,OAAKA,EAAE3C","file":"static/js/app.259628fb4df5e9367e45.js","sourcesContent":["<template>\n  <div style=\"height: 100%;\">\n    <div id=\"map\" :class=\"{ ready: styleReady }\"></div>\n    <template v-if=\"styleReady\">\n      <slot :mapboxgl=\"mapboxgl\" :map=\"map\" />\n    </template>\n  </div>\n</template>\n\n<script>\nconst circleToPolygon = require('circle-to-polygon')\n\nexport default {\n  props: ['apikey', 'mapboxStyle', 'actualCoords', 'showActual'],\n\n  data() {\n    return {\n      mapboxgl: null,\n      map: null,\n      styleReady: false,\n      actualMarker: null,\n      userCoords: null,\n      userMarker: null,\n      startTime: Date.now(),\n      polygon: [\n        [121.4849281311035, 25.041282077030896],\n        [121.48338317871094, 25.034127684732027],\n        [121.49436950683594, 25.010328552422727],\n        [121.50930404663085, 25.02183982004383],\n        [121.52097702026366, 25.019662095434153],\n        [121.53041839599611, 25.008617325916603],\n        [121.55376434326172, 25.02479524164605],\n        [121.5805435180664, 25.040504445908475],\n        [121.57178878784178, 25.051546345696423],\n        [121.56895637512207, 25.072383277538737],\n        [121.50604248046874, 25.079069004534098],\n        [121.50604248046874, 25.05823320992254],\n        [121.4849281311035, 25.041282077030896],\n      ],\n      defaultPosition: {\n        bearing: 0,\n        center: [121.53076171875, 25.04392598596459],\n        zoom: 10.2,\n        pitch: 0,\n        speed: 2,\n      },\n    }\n  },\n\n  watch: {\n    actualCoords() {\n      if (this.userMarker && !this.showActual) {\n        this.startTime = Date.now()\n        this.userMarker.remove()\n      }\n    },\n    showActual(shouldShow) {\n      if (!this.mapboxgl || !this.map) return\n      if (this.actualMarker || !shouldShow) this.actualMarker.remove()\n\n      this.fitToKyoto()\n\n      if (shouldShow)\n        this.actualMarker = new this.mapboxgl.Marker({ color: '#ffbb00' })\n          .setLngLat(this.actualCoords)\n          .addTo(this.map)\n      else {\n        if (this.map && this.mapboxgl && this.map.getLayer('linebetween')) {\n          this.map.removeLayer('linebetween')\n          this.map.removeSource('linebetween')\n          this.map.removeLayer('circlearound')\n          this.map.removeSource('circlearound')\n        }\n      }\n    },\n    userCoords(newCoords) {\n      if (!this.mapboxgl || !this.map) return\n      if (this.userMarker || !newCoords) this.userMarker.remove()\n\n      this.fitToKyoto()\n\n      if (newCoords) {\n        this.map.addLayer({\n          id: 'linebetween',\n          type: 'line',\n          source: {\n            type: 'geojson',\n            data: {\n              type: 'Feature',\n              geometry: {\n                type: 'LineString',\n                coordinates: [\n                  [this.actualCoords.lng, this.actualCoords.lat],\n                  newCoords,\n                ],\n              },\n            },\n          },\n          layout: {},\n          paint: {\n            'line-color': '#77bbff',\n            'line-width': 2,\n          },\n        })\n\n        const polygon = circleToPolygon(\n          [this.actualCoords.lng, this.actualCoords.lat],\n          1000,\n          32\n        )\n\n        this.map.addLayer({\n          id: 'circlearound',\n          type: 'fill',\n          source: {\n            type: 'geojson',\n            data: {\n              type: 'Feature',\n              geometry: polygon,\n            },\n          },\n          layout: {},\n          paint: {\n            'fill-color': 'rgba(255,187,0,.3)',\n          },\n        })\n\n        this.userMarker = new this.mapboxgl.Marker({ color: '#77bbff' })\n          .setLngLat(newCoords)\n          .addTo(this.map)\n\n        const distance = getDistanceFromLatLonInKm(\n          this.actualCoords.lng,\n          this.actualCoords.lat,\n          ...newCoords\n        )\n        this.$emit('distanceOff', distance)\n\n        const payloadToDatabase = {\n          actualCoords: [this.actualCoords.lng, this.actualCoords.lat],\n          userCoords: newCoords,\n          date: new Date(),\n          distanceOffInKm: distance,\n          timeTakenInMs: Date.now() - this.startTime,\n        }\n        fetch('http://0.0.0.0:3008/dataupload', {\n          method: 'post',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payloadToDatabase),\n        })\n          .then(res => {\n            return res.json()\n          })\n          .then(data => {\n            if (!data || data.status !== 'ok')\n              console.error('Failed on server!', data.status)\n            else console.info('saved!')\n          })\n      }\n    },\n  },\n\n  mounted() {\n    if (!document) return\n    this.mapboxgl = require('mapbox-gl/dist/mapbox-gl.js')\n    this.mapboxgl.accessToken = this.apikey\n\n    this.map = new this.mapboxgl.Map({\n      container: 'map',\n      style: this.mapboxStyle,\n      ...this.defaultPosition,\n    })\n\n    this.map.on('styledata', () => {\n      setTimeout(() => (this.styleReady = true), 300)\n\n      this.map.setLayoutProperty('country-label', 'text-field', [\n        'get',\n        'name_zh-Hans',\n      ])\n      this.map.setLayoutProperty('state-label', 'text-field', [\n        'get',\n        'name_zh-Hans',\n      ])\n      this.map.setLayoutProperty('place-city-label', 'text-field', [\n        'get',\n        'name_zh-Hans',\n      ])\n\n      this.map.setLayoutProperty(\n        'place-town-village-hamlet-label',\n        'text-field',\n        ['get', 'name_zh-Hans']\n      )\n\n      this.map.setLayoutProperty(\n        'place-neighborhood-suburb-label',\n        'text-field',\n        ['get', 'name_zh-Hans']\n      )\n\n      this.map.setLayoutProperty('road-label', 'text-field', [\n        'get',\n        'name_zh-Hans',\n      ])\n    })\n\n    this.map.on('load', () => {\n      this.fitToKyoto()\n      this.map.addLayer({\n        id: 'kyotooutlinelayer',\n        type: 'line',\n        source: {\n          type: 'geojson',\n          data: {\n            type: 'Feature',\n            geometry: {\n              type: 'Polygon',\n              coordinates: [this.polygon],\n            },\n          },\n        },\n        layout: {},\n        paint: {\n          'line-color': '#0099ff',\n          'line-width': 3,\n        },\n      })\n    })\n\n    this.map.on('click', e => {\n      if (!e.lngLat) return\n      if (this.showActual) {\n        return\n      }\n      this.$emit('showActual')\n      this.userCoords = [e.lngLat.lng, e.lngLat.lat]\n    })\n  },\n\n  methods: {\n    fitToKyoto() {\n      this.map.fitBounds(\n        [\n          [\n            Math.max(...this.polygon.map(p => p[0])),\n            Math.max(...this.polygon.map(p => p[1])),\n          ],\n          [\n            Math.min(...this.polygon.map(p => p[0])),\n            Math.min(...this.polygon.map(p => p[1])),\n          ],\n        ],\n        { padding: { top: 20, left: 20, bottom: 20, right: 20 } }\n      )\n    },\n  },\n}\n\nfunction getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {\n  var R = 6371 // Radius of the earth in km\n  var dLat = deg2rad(lat2 - lat1) // deg2rad below\n  var dLon = deg2rad(lon2 - lon1)\n  var a =\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(deg2rad(lat1)) *\n      Math.cos(deg2rad(lat2)) *\n      Math.sin(dLon / 2) *\n      Math.sin(dLon / 2)\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n  var d = R * c // Distance in km\n  return d\n}\nfunction deg2rad(deg) {\n  return deg * (Math.PI / 180)\n}\n</script>\n\n<style>\n#map {\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  transition: opacity 3s;\n}\n\n#map,\ncanvas {\n  outline: none !important;\n}\n\n#map.ready {\n  opacity: 1;\n}\n\n#map.focus {\n  outline: 0;\n}\n\n.mapbox-ctrl-attrib,\n.mapboxgl-missing-css,\n.mapboxgl-control-container {\n  display: none;\n}\n\n.mapboxgl-marker {\n  position: absolute;\n  z-index: 2;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/MapboxMapLoader.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"height\":\"100%\"}},[_c('div',{class:{ ready: _vm.styleReady },attrs:{\"id\":\"map\"}}),_vm._v(\" \"),(_vm.styleReady)?[_vm._t(\"default\",null,{\"mapboxgl\":_vm.mapboxgl,\"map\":_vm.map})]:_vm._e()],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-51751a40\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/MapboxMapLoader.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-51751a40\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./MapboxMapLoader.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./MapboxMapLoader.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./MapboxMapLoader.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-51751a40\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./MapboxMapLoader.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/MapboxMapLoader.vue\n// module id = null\n// module chunks = ","<template>\n  <MapboxMapLoader\n    :apikey=\"ak\"\n    mapboxStyle=\"mapbox://styles/midblue/cjv2c454j6eoy1fnx66ks9tpw\"\n    :actualCoords=\"actualCoords\"\n    :showActual=\"showActual\"\n    @showActual=\"$emit('showActual')\"\n    @distanceOff=\"distance => $emit('distanceOff', distance)\"\n  >\n    <template slot-scope=\"{ mapboxgl, map, clusterer }\"></template>\n  </MapboxMapLoader>\n</template>\n\n<script>\n//mapbox://styles/mariko9012/cjh4gkzlw31mc2sqsm3l0g4rk\nimport MapboxMapLoader from './MapboxMapLoader'\n\nexport default {\n  props: ['actualCoords', 'showActual'],\n  components: {\n    MapboxMapLoader,\n  },\n  data() {\n    return {\n      ak: process.env.MAPBOX,\n      markers: [],\n      updatePrefix: 0,\n    }\n  },\n\n  computed: {},\n\n  watch: {},\n\n  methods: {},\n}\n</script>\n\n<style></style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Map.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('MapboxMapLoader',{attrs:{\"apikey\":_vm.ak,\"mapboxStyle\":\"mapbox://styles/midblue/cjv2c454j6eoy1fnx66ks9tpw\",\"actualCoords\":_vm.actualCoords,\"showActual\":_vm.showActual},on:{\"showActual\":function($event){return _vm.$emit('showActual')},\"distanceOff\":function (distance) { return _vm.$emit('distanceOff', distance); }},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar mapboxgl = ref.mapboxgl;\nvar map = ref.map;\nvar clusterer = ref.clusterer;\nreturn undefined}}])})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-1b71e621\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Map.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-1b71e621\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Map.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Map.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Map.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-1b71e621\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Map.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Map.vue\n// module id = null\n// module chunks = ","<template>\n  <div>\n    <div class=\"streetviewcontainer\">\n      <div id=\"streetview\" ref=\"streetview\"></div>\n    </div>\n    <div class=\"right\">\n      <div class=\"righttop\">\n        <div v-if=\"showActual\">\n          <template v-if=\"distanceOff && distanceOff > 1\">Close!</template>\n          <template v-if=\"distanceOff && distanceOff <= 1 && distanceOff > 0\"\n            >You got it!</template\n          >\n          <template v-if=\"distanceOff && distanceOff > 0\">\n            The spot you picked is\n            <span class=\"highlight\">{{ distanceOff.toFixed(2) }}km away.</span\n            >。\n          </template>\n        </div>\n        <div v-else>Where do you think this is? Pick a location.</div>\n\n        <button v-if=\"showActual\" class=\"nextbutton\" @click=\"nextLocation\">\n          Next\n        </button>\n      </div>\n      <Map\n        :actualCoords=\"{ lat, lng }\"\n        :showActual=\"showActual\"\n        @showActual=\"showActual = true\"\n        @distanceOff=\"distance => (distanceOff = distance)\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport Map from './components/Map'\nconst randomPointsOnPolygon = require('random-points-on-polygon')\n\nexport default {\n  components: { Map },\n  data() {\n    return {\n      lat: null,\n      lng: null,\n      showActual: false,\n      distanceOff: null,\n      panoObject: null,\n      gk: process.env.GMAPS,\n      taipeiPolygon: {\n        type: 'Feature',\n        properties: {},\n        geometry: {\n          type: 'Polygon',\n          coordinates: [\n            [\n              [121.4849281311035, 25.041282077030896],\n              [121.48338317871094, 25.034127684732027],\n              [121.49436950683594, 25.010328552422727],\n              [121.50930404663085, 25.02183982004383],\n              [121.52097702026366, 25.019662095434153],\n              [121.53041839599611, 25.008617325916603],\n              [121.55376434326172, 25.02479524164605],\n              [121.5805435180664, 25.040504445908475],\n              [121.57178878784178, 25.051546345696423],\n              [121.56895637512207, 25.072383277538737],\n              [121.50604248046874, 25.079069004534098],\n              [121.50604248046874, 25.05823320992254],\n              [121.4849281311035, 25.041282077030896],\n            ],\n          ],\n        },\n      },\n    }\n  },\n  watch: {\n    distanceOff(newDistance) {\n      if (newDistance > 0 && newDistance < 1) {\n        setTimeout(() => {\n          console.log('Winner!!', new Date())\n        }, 300)\n      }\n    },\n  },\n  created() {\n    let mapsAPIScript = document.createElement('script')\n    mapsAPIScript.setAttribute(\n      'src',\n      `https://maps.googleapis.com/maps/api/js?key=${this.gk}&callback=initializeGoogleMapsAPI`\n    )\n    window.initializeGoogleMapsAPI = this.nextLocation\n    document.head.appendChild(mapsAPIScript)\n  },\n  methods: {\n    getRandomPoint() {\n      return randomPointsOnPolygon(1, this.taipeiPolygon)[0]\n    },\n    nextLocation() {\n      this.showActual = false\n      const point = this.getRandomPoint().geometry.coordinates\n      const heading = Math.floor(Math.random() * 360)\n      // console.log(point[1], point[0], heading)\n      this.lat = point[1]\n      this.lng = point[0]\n      if (!this.panoObject)\n        this.panoObject = new google.maps.StreetViewPanorama(\n          this.$refs.streetview,\n          {\n            position: { lat: this.lat, lng: this.lng },\n            pov: { heading, pitch: 0 },\n            // clickToGo: false,\n            showRoadLabels: false,\n            zoom: 0,\n          }\n        )\n      else {\n        this.panoObject.setPosition({ lat: this.lat, lng: this.lng })\n        this.panoObject.setPov({ heading, pitch: 0, zoom: 0 })\n      }\n\n      setTimeout(() => {\n        if (!this.panoObject.pano) {\n          console.log('pano failed!')\n          this.nextLocation()\n        }\n      }, 700)\n    },\n  },\n}\n</script>\n\n<style>\nhtml,\nbody {\n  margin: 0;\n  font-family: 'Avenir', sans-serif;\n}\n\n.streetviewcontainer {\n  position: fixed;\n  z-index: 3;\n  top: 0;\n  left: 0;\n  height: 100vh;\n  width: 50vw;\n}\n#streetview {\n  height: 100vh;\n  width: 50vw;\n}\n\n.gm-control-active,\n.gm-iv-address,\n.gm-style-cc,\n.gmnoprint,\n#streetview img,\n.gmnoscreen {\n  display: none;\n}\n\n.right {\n  height: 100vh;\n  position: absolute;\n  width: 50vw;\n  left: 50%;\n  top: 0;\n  display: grid;\n  grid-template-rows: 80px 1fr;\n}\n\n.right .righttop {\n  background: floralwhite;\n  color: #444;\n  position: relative;\n  text-align: center;\n  height: 100%;\n  display: flex;\n  justify-content: stretch;\n  align-items: center;\n  font-size: 1.8rem;\n}\n.right .righttop > * {\n  flex-grow: 1;\n}\n.highlight {\n  color: green;\n  font-weight: 600;\n}\n\nbutton {\n  height: 100%;\n  border: none;\n  font-size: 1em;\n  padding: 0 30px;\n  background: green;\n  color: white;\n  transition: all 0.2s;\n  color: white;\n  outline: 0;\n}\n\nbutton:hover {\n  background: darkgreen;\n  cursor: pointer;\n}\n\nbutton.secondary {\n  background: gray;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/App.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"streetviewcontainer\"},[_c('div',{ref:\"streetview\",attrs:{\"id\":\"streetview\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"right\"},[_c('div',{staticClass:\"righttop\"},[(_vm.showActual)?_c('div',[(_vm.distanceOff && _vm.distanceOff > 1)?[_vm._v(\"Close!\")]:_vm._e(),_vm._v(\" \"),(_vm.distanceOff && _vm.distanceOff <= 1 && _vm.distanceOff > 0)?[_vm._v(\"You got it!\")]:_vm._e(),_vm._v(\" \"),(_vm.distanceOff && _vm.distanceOff > 0)?[_vm._v(\"\\n          The spot you picked is\\n          \"),_c('span',{staticClass:\"highlight\"},[_vm._v(_vm._s(_vm.distanceOff.toFixed(2))+\"km away.\")]),_vm._v(\"。\\n        \")]:_vm._e()],2):_c('div',[_vm._v(\"Where do you think this is? Pick a location.\")]),_vm._v(\" \"),(_vm.showActual)?_c('button',{staticClass:\"nextbutton\",on:{\"click\":_vm.nextLocation}},[_vm._v(\"\\n        Next\\n      \")]):_vm._e()]),_vm._v(\" \"),_c('Map',{attrs:{\"actualCoords\":{ lat: _vm.lat, lng: _vm.lng },\"showActual\":_vm.showActual},on:{\"showActual\":function($event){_vm.showActual = true},\"distanceOff\":function (distance) { return (_vm.distanceOff = distance); }}})],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-78cc3e88\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-78cc3e88\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-78cc3e88\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","import Vue from 'vue'\nimport App from './App'\n\nVue.config.productionTip = false\n\nnew Vue({\n  el: '#app',\n  render: h => h(App),\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}